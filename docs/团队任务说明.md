# 🚀 团队Git操作指南

## 一、项目推送清单（组长操作）

### 需要推送的文件

```
✅ 需要推送到Git的文件：
├── .gitignore                     # Git忽略配置
├── README.md                      # 项目说明
├── requirements.txt               # Python依赖
│
├── docs/                          # 文档目录
│   ├── 项目整体规划.md            # 完整操作指南
│   └── 团队任务说明.md            # 本文件
│
├── src/                           # 源代码
│   ├── config.py                  # 配置文件
│   ├── data/                      # 数据加载模块
│   │   ├── __init__.py
│   │   └── data_loader.py
│   ├── models/                    # 模型定义
│   │   ├── __init__.py
│   │   ├── base_model.py         # 模型基类（重要！）
│   │   └── resnet50.py           # 示例模型
│   ├── training/                  # 训练模块
│   │   ├── __init__.py
│   │   ├── trainer.py
│   │   └── callbacks.py
│   ├── evaluation/                # 评估模块
│   │   ├── __init__.py
│   │   └── evaluator.py
│   ├── ensemble/                  # 集成学习模块
│   │   ├── __init__.py
│   │   ├── ensemble_model.py
│   │   └── voting.py
│   └── preprocessing/             # 数据预处理（已完成）
│
├── scripts/                       # 运行脚本
│   ├── train_model.py
│   ├── evaluate_model.py
│   └── run_ensemble.py
│
├── trained_models/                # 模型保存目录
│   └── .gitkeep
│
└── output/preprocessing/          # 预处理结果
    ├── train.csv
    ├── val.csv
    └── test.csv

❌ 不需要推送的文件（已在.gitignore中配置）：
├── data/                          # 原始数据（太大）
├── __pycache__/                   # Python缓存
├── *.pyc                          # 编译文件
├── venv/                          # 虚拟环境
└── .idea/ .vscode/                # IDE配置
```

### 组长推送步骤

```bash
# 1. 进入项目目录
cd D:\machine_learning\code

# 2. 初始化Git（如果还没有）
git init

# 3. 添加远程仓库（替换为你的仓库地址）
git remote add origin https://github.com/你的用户名/diabetic-retinopathy.git

# 4. 添加所有文件
git add .

# 5. 查看将要提交的文件（确认没有大文件）
git status

# 6. 提交
git commit -m "feat: 初始化项目框架 - 集成学习系统"

# 7. 推送到远程仓库
git push -u origin main
```

---

## 二、组员操作教程

### 第一步：克隆项目

```bash
# 克隆项目到本地
git clone https://github.com/你的用户名/diabetic-retinopathy.git

# 进入项目目录
cd diabetic-retinopathy
```

### 第二步：安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 第三步：准备数据

将数据集放到正确位置：
```
D:\machine_learning\data\data2\
├── 0/    # 无病变图片
├── 1/    # 轻度图片
├── 2/    # 中度图片
├── 3/    # 重度图片
└── 4/    # 增殖性图片
```

**注意**：数据文件不需要上传Git，每个人在自己电脑上准备即可。

### 第四步：创建自己的分支

```bash
# 确保在main分支上
git checkout main
git pull origin main

# 创建并切换到自己的分支
# ⚠️ 根据你负责的模型选择对应的分支名：

# 成员A（前端）- 负责 VGG-16 和 MobileNetV2
git checkout -b model-vgg-mobilenet

# 成员B（代码强）- 负责 SE-ResNet 和 ResNeXt-50
git checkout -b model-seresnet-resnext

# 成员C - 负责 DenseNet-121 和 InceptionV3
git checkout -b model-densenet-inception
```

### 第五步：实现你的模型

参考 `src/models/resnet50.py` 创建你的模型文件：

```python
# 例如：src/models/vgg16.py
from .base_model import BaseModel
from tensorflow import keras
from tensorflow.keras import layers

class VGG16Model(BaseModel):
    """VGG-16 模型 - 成员A负责"""
    
    def __init__(self, num_classes: int = 5,
                 input_shape: tuple = (224, 224, 3),
                 pretrained: bool = True):
        super().__init__(
            model_name='vgg16',  # ⚠️ 改成你的模型名
            num_classes=num_classes,
            input_shape=input_shape
        )
        self.pretrained = pretrained
    
    def build(self) -> keras.Model:
        # 加载预训练模型
        base_model = keras.applications.VGG16(  # ⚠️ 改成你的模型
            weights='imagenet' if self.pretrained else None,
            include_top=False,
            input_shape=self.input_shape
        )
        
        base_model.trainable = False
        
        # 构建模型
        inputs = keras.Input(shape=self.input_shape)
        x = base_model(inputs, training=False)
        x = layers.GlobalAveragePooling2D()(x)
        x = layers.Dropout(0.5)(x)
        x = layers.Dense(256, activation='relu')(x)
        x = layers.Dropout(0.3)(x)
        outputs = layers.Dense(self.num_classes, activation='softmax')(x)
        
        self.model = keras.Model(inputs, outputs)
        return self.model
```

### 第六步：训练模型

```bash
# 训练你的模型（替换model名称）
python scripts/train_model.py --model vgg16 --epochs 50 --batch_size 32

# 如果GPU内存不足，减小batch_size
python scripts/train_model.py --model vgg16 --epochs 50 --batch_size 16
```

### 第七步：评估模型

```bash
# 评估模型
python scripts/evaluate_model.py --model vgg16
```

### 第八步：检查输出文件

确保以下文件都已生成：
```
trained_models/vgg16/
├── vgg16_best.keras          ✅ 必须有
├── training_history.json     ✅ 必须有
├── evaluation_report.json    ✅ 必须有
├── confusion_matrix.png      ✅ 必须有
└── metadata.json             ✅ 必须有
```

### 第九步：提交代码

```bash
# 添加你的更改
git add .

# 提交（写清楚你做了什么）
git commit -m "feat: 完成VGG-16模型训练，准确率82%"

# 推送到远程仓库
git push origin model-vgg-mobilenet  # 替换为你的分支名
```

### 第十步：创建Pull Request

1. 打开GitHub/GitLab仓库页面
2. 点击 "Pull requests" → "New pull request"
3. 选择：`base: main` ← `compare: 你的分支名`
4. 填写标题和描述
5. 点击 "Create pull request"
6. 等待组长审核合并

---

## 三、各成员任务清单

### 成员A（前端）- 分支: `model-vgg-mobilenet`

| 任务 | 文件 | 状态 |
|------|------|------|
| 实现VGG-16模型 | `src/models/vgg16.py` | ⬜ |
| 训练VGG-16 | `trained_models/vgg16/` | ⬜ |
| 评估VGG-16 | 生成评估报告 | ⬜ |
| 实现MobileNetV2模型 | `src/models/mobilenetv2.py` | ⬜ |
| 训练MobileNetV2 | `trained_models/mobilenetv2/` | ⬜ |
| 评估MobileNetV2 | 生成评估报告 | ⬜ |

**预训练模型使用：**
```python
# VGG-16
keras.applications.VGG16(weights='imagenet', include_top=False)

# MobileNetV2
keras.applications.MobileNetV2(weights='imagenet', include_top=False)
```

### 成员B（代码强）- 分支: `model-seresnet-resnext`

| 任务 | 文件 | 状态 |
|------|------|------|
| 实现SE-ResNet模型 | `src/models/se_resnet.py` | ⬜ |
| 训练SE-ResNet | `trained_models/se_resnet/` | ⬜ |
| 评估SE-ResNet | 生成评估报告 | ⬜ |
| 实现ResNeXt-50模型 | `src/models/resnext50.py` | ⬜ |
| 训练ResNeXt-50 | `trained_models/resnext50/` | ⬜ |
| 评估ResNeXt-50 | 生成评估报告 | ⬜ |

**SE模块实现参考：**
```python
def se_block(input_tensor, ratio=16):
    """Squeeze-and-Excitation模块"""
    channels = input_tensor.shape[-1]
    
    # Squeeze
    x = layers.GlobalAveragePooling2D()(input_tensor)
    
    # Excitation
    x = layers.Dense(channels // ratio, activation='relu')(x)
    x = layers.Dense(channels, activation='sigmoid')(x)
    
    # Scale
    x = layers.Reshape((1, 1, channels))(x)
    return layers.Multiply()([input_tensor, x])
```

### 成员C - 分支: `model-densenet-inception`

| 任务 | 文件 | 状态 |
|------|------|------|
| 实现DenseNet-121模型 | `src/models/densenet121.py` | ⬜ |
| 训练DenseNet-121 | `trained_models/densenet121/` | ⬜ |
| 评估DenseNet-121 | 生成评估报告 | ⬜ |
| 实现InceptionV3模型 | `src/models/inceptionv3.py` | ⬜ |
| 训练InceptionV3 | `trained_models/inceptionv3/` | ⬜ |
| 评估InceptionV3 | 生成评估报告 | ⬜ |

**预训练模型使用：**
```python
# DenseNet-121
keras.applications.DenseNet121(weights='imagenet', include_top=False)

# InceptionV3 ⚠️ 注意：输入尺寸是299x299！
keras.applications.InceptionV3(weights='imagenet', include_top=False, 
                               input_shape=(299, 299, 3))
```

**InceptionV3特殊处理：**
```python
class InceptionV3Model(BaseModel):
    def __init__(self):
        super().__init__(
            model_name='inceptionv3',
            input_shape=(299, 299, 3)  # ⚠️ 特殊尺寸
        )
```

---

## 四、常见问题

### Q1: 训练时GPU内存不足？
```bash
# 减小batch_size
python scripts/train_model.py --model vgg16 --batch_size 8
```

### Q2: 如何查看训练进度？
训练过程中会实时显示loss和accuracy，也可以用TensorBoard：
```bash
tensorboard --logdir=trained_models/vgg16/logs
```

### Q3: 模型准确率太低怎么办？
1. 增加训练轮数 `--epochs 100`
2. 调整学习率 `--learning_rate 0.0001`
3. 尝试解冻部分预训练层进行微调

### Q4: Git冲突怎么解决？
```bash
# 先拉取最新代码
git pull origin main

# 如果有冲突，手动解决后
git add .
git commit -m "fix: 解决合并冲突"
git push
```

### Q5: 忘记切换分支就开始写代码了？
```bash
# 暂存当前更改
git stash

# 创建并切换到正确分支
git checkout -b model-vgg-mobilenet

# 恢复更改
git stash pop
```

---

## 五、提交检查清单

提交PR前，请确认：

- [ ] 模型文件 `{model_name}_best.keras` 存在
- [ ] 训练历史 `training_history.json` 存在
- [ ] 评估报告 `evaluation_report.json` 存在
- [ ] 混淆矩阵 `confusion_matrix.png` 存在
- [ ] 代码可以正常运行
- [ ] 模型准确率 > 70%

---

## 六、联系方式

遇到问题请及时在群里沟通！

祝大家顺利完成任务！🎉
