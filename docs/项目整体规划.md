# ç³–å°¿ç—…è§†ç½‘è†œç—…å˜å›¾åƒåˆ†ç±» - é›†æˆå­¦ä¹ é¡¹ç›®

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä½¿ç”¨ 8 ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œé›†æˆå­¦ä¹ ï¼Œå¯¹ç³–å°¿ç—…è§†ç½‘è†œç—…å˜å›¾åƒè¿›è¡Œ 5 åˆ†ç±»ã€‚

- **åˆ†ç±»ç±»åˆ«**: 0-æ— ç—…å˜, 1-è½»åº¦, 2-ä¸­åº¦, 3-é‡åº¦, 4-å¢æ®–æ€§
- **æ•°æ®ä½ç½®**: `D:\machine_learning\data\data2`
- **æ¨¡å‹æ•°é‡**: 8ä¸ªï¼ˆæ¯äºº2ä¸ªï¼‰

## ğŸ‘¥ å›¢é˜Ÿåˆ†å·¥

| æˆå‘˜ | è´Ÿè´£æ¨¡å‹ | Gitåˆ†æ”¯å | æ¨¡å‹æ–‡ä»¶ä½ç½® |
|------|----------|-----------|--------------|
| ç»„é•¿ | ResNet-50, EfficientNet-B0 | `model-resnet-efficientnet` | `trained_models/resnet50/`, `trained_models/efficientnet_b0/` |
| æˆå‘˜Aï¼ˆå‰ç«¯ï¼‰ | VGG-16, MobileNetV2 | `model-vgg-mobilenet` | `trained_models/vgg16/`, `trained_models/mobilenetv2/` |
| æˆå‘˜Bï¼ˆä»£ç å¼ºï¼‰ | SE-ResNet, ResNeXt-50 | `model-seresnet-resnext` | `trained_models/se_resnet/`, `trained_models/resnext50/` |
| æˆå‘˜C | DenseNet-121, InceptionV3 | `model-densenet-inception` | `trained_models/densenet121/`, `trained_models/inceptionv3/` |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
diabetic-retinopathy/
â”œâ”€â”€ data/                          # æ•°æ®ç›®å½•ï¼ˆä¸ä¸Šä¼  Gitï¼‰
â”‚   â””â”€â”€ data2/
â”‚       â”œâ”€â”€ 0/ ~ 4/               # åŸå§‹å›¾ç‰‡ï¼ˆæŒ‰ç±»åˆ«ï¼‰
â”‚
â”œâ”€â”€ src/                           # æºä»£ç 
â”‚   â”œâ”€â”€ config.py                  # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ preprocessing/             # æ•°æ®é¢„å¤„ç†ï¼ˆå·²å®Œæˆ âœ“ï¼‰
â”‚   â”‚   â”œâ”€â”€ dataset_splitter.py   # æ•°æ®é›†åˆ’åˆ†
â”‚   â”‚   â”œâ”€â”€ class_balancer.py     # ç±»åˆ«å¹³è¡¡
â”‚   â”‚   â”œâ”€â”€ visualization.py      # å¯è§†åŒ–
â”‚   â”‚   â””â”€â”€ augmentation/         # æ•°æ®å¢å¼º
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                      # æ•°æ®åŠ è½½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ data_loader.py        # ç»Ÿä¸€æ•°æ®åŠ è½½å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                    # æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_model.py         # æ¨¡å‹åŸºç±»ï¼ˆç»„é•¿æä¾›ï¼‰
â”‚   â”‚   â”œâ”€â”€ resnet50.py           # ç»„é•¿
â”‚   â”‚   â”œâ”€â”€ efficientnet_b0.py    # ç»„é•¿
â”‚   â”‚   â”œâ”€â”€ vgg16.py              # æˆå‘˜A
â”‚   â”‚   â”œâ”€â”€ mobilenetv2.py        # æˆå‘˜A
â”‚   â”‚   â”œâ”€â”€ se_resnet.py          # æˆå‘˜B
â”‚   â”‚   â”œâ”€â”€ resnext50.py          # æˆå‘˜B
â”‚   â”‚   â”œâ”€â”€ densenet121.py        # æˆå‘˜C
â”‚   â”‚   â””â”€â”€ inceptionv3.py        # æˆå‘˜C
â”‚   â”‚
â”‚   â”œâ”€â”€ training/                  # è®­ç»ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ trainer.py            # é€šç”¨è®­ç»ƒå™¨
â”‚   â”‚   â””â”€â”€ callbacks.py          # å›è°ƒå‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ evaluation/                # è¯„ä¼°æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ evaluator.py          # æ¨¡å‹è¯„ä¼°å™¨
â”‚   â”‚   â””â”€â”€ metrics.py            # è¯„ä¼°æŒ‡æ ‡
â”‚   â”‚
â”‚   â””â”€â”€ ensemble/                  # é›†æˆå­¦ä¹ æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ ensemble_model.py     # é›†æˆæ¨¡å‹
â”‚       â””â”€â”€ voting.py             # æŠ•ç¥¨ç­–ç•¥
â”‚
â”œâ”€â”€ trained_models/                # è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆä¸Šä¼  Gitï¼‰
â”‚   â”œâ”€â”€ resnet50/
â”‚   â”‚   â”œâ”€â”€ resnet50_best.keras   # æ¨¡å‹æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ training_history.json # è®­ç»ƒå†å²
â”‚   â”‚   â”œâ”€â”€ evaluation_report.json# è¯„ä¼°æŠ¥å‘Š
â”‚   â”‚   â””â”€â”€ confusion_matrix.png  # æ··æ·†çŸ©é˜µ
â”‚   â”œâ”€â”€ efficientnet_b0/
â”‚   â”œâ”€â”€ vgg16/
â”‚   â”œâ”€â”€ mobilenetv2/
â”‚   â”œâ”€â”€ se_resnet/
â”‚   â”œâ”€â”€ resnext50/
â”‚   â”œâ”€â”€ densenet121/
â”‚   â””â”€â”€ inceptionv3/
â”‚
â”œâ”€â”€ output/                        # è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ preprocessing/            # é¢„å¤„ç†ç»“æœï¼ˆå·²å®Œæˆ âœ“ï¼‰
â”‚   â”‚   â”œâ”€â”€ train.csv
â”‚   â”‚   â”œâ”€â”€ val.csv
â”‚   â”‚   â””â”€â”€ test.csv
â”‚   â”œâ”€â”€ training_logs/            # è®­ç»ƒæ—¥å¿—
â”‚   â””â”€â”€ evaluation/               # è¯„ä¼°ç»“æœ
â”‚
â”œâ”€â”€ scripts/                       # è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ train_model.py            # è®­ç»ƒå•ä¸ªæ¨¡å‹
â”‚   â”œâ”€â”€ evaluate_model.py         # è¯„ä¼°å•ä¸ªæ¨¡å‹
â”‚   â””â”€â”€ run_ensemble.py           # è¿è¡Œé›†æˆå­¦ä¹ 
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```


## ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1: æ¡†æ¶æ­å»ºï¼ˆç»„é•¿ï¼‰                      â”‚
â”‚  âœ“ æ•°æ®é¢„å¤„ç†å·²å®Œæˆ                                              â”‚
â”‚  â†’ åˆ›å»ºæ¨¡å‹åŸºç±»ã€æ•°æ®åŠ è½½å™¨ã€è®­ç»ƒå™¨ã€è¯„ä¼°å™¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Phase 2: å„è‡ªè®­ç»ƒæ¨¡å‹ï¼ˆå…¨å‘˜å¹¶è¡Œï¼‰                  â”‚
â”‚  æ¯ä¸ªæˆå‘˜åœ¨è‡ªå·±åˆ†æ”¯ä¸Šï¼š                                           â”‚
â”‚  1. å®ç°æ¨¡å‹ç±»ï¼ˆç»§æ‰¿ BaseModelï¼‰                                  â”‚
â”‚  2. è®­ç»ƒæ¨¡å‹å¹¶ä¿å­˜ .keras æ–‡ä»¶                                    â”‚
â”‚  3. è¯„ä¼°æ¨¡å‹å¹¶ç”ŸæˆæŠ¥å‘Š                                           â”‚
â”‚  4. æäº¤ Pull Request                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 3: é›†æˆå­¦ä¹ ï¼ˆç»„é•¿ï¼‰                      â”‚
â”‚  1. åˆå¹¶æ‰€æœ‰åˆ†æ”¯åˆ° main                                          â”‚
â”‚  2. åŠ è½½æ‰€æœ‰è®­ç»ƒå¥½çš„æ¨¡å‹                                          â”‚
â”‚  3. å®ç°æŠ•ç¥¨ç­–ç•¥ï¼ˆç¡¬æŠ•ç¥¨ã€è½¯æŠ•ç¥¨ã€åŠ æƒæŠ•ç¥¨ï¼‰                         â”‚
â”‚  4. ç”Ÿæˆæœ€ç»ˆå¯¹æ¯”æŠ¥å‘Š                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“… æ—¶é—´å®‰æ’

| é˜¶æ®µ | ä»»åŠ¡ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ |
|------|------|--------|----------|
| Phase 1 | æ¡†æ¶æ­å»º | ç»„é•¿ | Day 1-2 |
| Phase 2 | å„è‡ªè®­ç»ƒæ¨¡å‹ | å…¨å‘˜å¹¶è¡Œ | Day 3-5 |
| Phase 3 | é›†æˆå­¦ä¹  | ç»„é•¿ | Day 6 |
| Phase 4 | æµ‹è¯•ã€æ–‡æ¡£ | å…¨å‘˜ | Day 7 |

---

# ğŸš€ å›¢é˜Ÿæ“ä½œæŒ‡å—

## ä¸€ã€ç¯å¢ƒå‡†å¤‡ï¼ˆæ‰€æœ‰æˆå‘˜ï¼‰

### 1.1 å…‹éš†é¡¹ç›®
```bash
git clone <ä½ çš„ä»“åº“åœ°å€>
cd diabetic-retinopathy
```

### 1.2 å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 1.3 å‡†å¤‡æ•°æ®
å°†æ•°æ®é›†æ”¾åˆ° `D:\machine_learning\data\data2` ç›®å½•ä¸‹ï¼Œç»“æ„å¦‚ä¸‹ï¼š
```
data2/
â”œâ”€â”€ 0/    # æ— ç—…å˜å›¾ç‰‡
â”œâ”€â”€ 1/    # è½»åº¦å›¾ç‰‡
â”œâ”€â”€ 2/    # ä¸­åº¦å›¾ç‰‡
â”œâ”€â”€ 3/    # é‡åº¦å›¾ç‰‡
â””â”€â”€ 4/    # å¢æ®–æ€§å›¾ç‰‡
```

### 1.4 è¿è¡Œæ•°æ®é¢„å¤„ç†ï¼ˆå¦‚æœè¿˜æ²¡è¿è¡Œï¼‰
```bash
python src/main_preprocessing.py
```
è¿™ä¼šç”Ÿæˆ `output/preprocessing/` ä¸‹çš„ train.csv, val.csv, test.csv

---

## äºŒã€Git åˆ†æ”¯æ“ä½œ

### 2.1 åˆ›å»ºè‡ªå·±çš„åˆ†æ”¯
```bash
# ç¡®ä¿åœ¨ main åˆ†æ”¯ä¸Š
git checkout main
git pull origin main

# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°è‡ªå·±çš„åˆ†æ”¯
git checkout -b model-resnet-efficientnet    # ç»„é•¿
git checkout -b model-vgg-mobilenet          # æˆå‘˜A
git checkout -b model-seresnet-resnext       # æˆå‘˜B
git checkout -b model-densenet-inception     # æˆå‘˜C
```

### 2.2 æ—¥å¸¸æäº¤
```bash
git add .
git commit -m "feat: å®Œæˆ ResNet-50 æ¨¡å‹è®­ç»ƒ"
git push origin <ä½ çš„åˆ†æ”¯å>
```

### 2.3 å®Œæˆååˆ›å»º Pull Request
1. åœ¨ GitHub/GitLab ä¸Šåˆ›å»º Pull Request
2. é€‰æ‹©ä»ä½ çš„åˆ†æ”¯åˆå¹¶åˆ° main
3. ç­‰å¾…ç»„é•¿å®¡æ ¸åˆå¹¶

---

## ä¸‰ã€æ¨¡å‹å¼€å‘æµç¨‹ï¼ˆæ¯ä¸ªæˆå‘˜ï¼‰

### 3.1 åˆ›å»ºæ¨¡å‹æ–‡ä»¶

åœ¨ `src/models/` ç›®å½•ä¸‹åˆ›å»ºä½ çš„æ¨¡å‹æ–‡ä»¶ï¼Œä¾‹å¦‚ `vgg16.py`ï¼š

```python
# src/models/vgg16.py
from .base_model import BaseModel
from tensorflow import keras
from tensorflow.keras import layers

class VGG16Model(BaseModel):
    """VGG-16 æ¨¡å‹ - æˆå‘˜Aè´Ÿè´£"""
    
    def __init__(self, num_classes: int = 5, 
                 input_shape: tuple = (224, 224, 3),
                 pretrained: bool = True):
        super().__init__(
            model_name='vgg16',
            num_classes=num_classes,
            input_shape=input_shape
        )
        self.pretrained = pretrained
    
    def build(self) -> keras.Model:
        # åŠ è½½é¢„è®­ç»ƒçš„ VGG16
        base_model = keras.applications.VGG16(
            weights='imagenet' if self.pretrained else None,
            include_top=False,
            input_shape=self.input_shape
        )
        
        # å†»ç»“é¢„è®­ç»ƒå±‚
        base_model.trainable = False
        
        # æ·»åŠ åˆ†ç±»å¤´
        inputs = keras.Input(shape=self.input_shape)
        x = base_model(inputs, training=False)
        x = layers.GlobalAveragePooling2D()(x)
        x = layers.Dropout(0.5)(x)
        x = layers.Dense(256, activation='relu')(x)
        x = layers.Dropout(0.3)(x)
        outputs = layers.Dense(self.num_classes, activation='softmax')(x)
        
        self.model = keras.Model(inputs, outputs)
        return self.model
```

### 3.2 è®­ç»ƒæ¨¡å‹

åˆ›å»ºè®­ç»ƒè„šæœ¬æˆ–ç›´æ¥è¿è¡Œï¼š

```python
# è®­ç»ƒè„šæœ¬ç¤ºä¾‹
from src.models.vgg16 import VGG16Model
from src.data.data_loader import DRDataLoader
from src.training.trainer import ModelTrainer

# 1. åŠ è½½æ•°æ®
loader = DRDataLoader(batch_size=32)
train_data = loader.load_train_data(augment=True)
val_data = loader.load_val_data()

# 2. åˆ›å»ºæ¨¡å‹
model = VGG16Model()

# 3. è®­ç»ƒ
trainer = ModelTrainer(model, save_dir='trained_models')
trainer.train(train_data, val_data, epochs=50)

print("è®­ç»ƒå®Œæˆï¼æ¨¡å‹å·²ä¿å­˜åˆ° trained_models/vgg16/")
```

### 3.3 è¯„ä¼°æ¨¡å‹

```python
from src.models.vgg16 import VGG16Model
from src.data.data_loader import DRDataLoader
from src.evaluation.evaluator import ModelEvaluator

# 1. åŠ è½½æµ‹è¯•æ•°æ®
loader = DRDataLoader(batch_size=32)
test_data = loader.load_test_data()

# 2. åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
model = VGG16Model()
model.load('trained_models/vgg16/vgg16_best.keras')

# 3. è¯„ä¼°
evaluator = ModelEvaluator(model, test_data)
report = evaluator.evaluate()
evaluator.save_report('trained_models/vgg16')

print(f"å‡†ç¡®ç‡: {report['accuracy']:.4f}")
print(f"F1 Score: {report['f1_macro']:.4f}")
```

### 3.4 æ£€æŸ¥è¾“å‡ºæ–‡ä»¶

è®­ç»ƒå®Œæˆåï¼Œç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
```
trained_models/vgg16/
â”œâ”€â”€ vgg16_best.keras          # æ¨¡å‹æ–‡ä»¶ï¼ˆå¿…é¡»ï¼‰
â”œâ”€â”€ training_history.json     # è®­ç»ƒå†å²ï¼ˆå¿…é¡»ï¼‰
â”œâ”€â”€ evaluation_report.json    # è¯„ä¼°æŠ¥å‘Šï¼ˆå¿…é¡»ï¼‰
â”œâ”€â”€ confusion_matrix.png      # æ··æ·†çŸ©é˜µå›¾ï¼ˆå¿…é¡»ï¼‰
â””â”€â”€ metadata.json             # å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
```

---

## å››ã€å„æ¨¡å‹å®ç°è¦ç‚¹

### 4.1 ç»„é•¿æ¨¡å‹

**ResNet-50**
```python
base_model = keras.applications.ResNet50(
    weights='imagenet', include_top=False, input_shape=(224, 224, 3)
)
```

**EfficientNet-B0**
```python
base_model = keras.applications.EfficientNetB0(
    weights='imagenet', include_top=False, input_shape=(224, 224, 3)
)
```

### 4.2 æˆå‘˜Aæ¨¡å‹

**VGG-16**
```python
base_model = keras.applications.VGG16(
    weights='imagenet', include_top=False, input_shape=(224, 224, 3)
)
```

**MobileNetV2**
```python
base_model = keras.applications.MobileNetV2(
    weights='imagenet', include_top=False, input_shape=(224, 224, 3)
)
```

### 4.3 æˆå‘˜Bæ¨¡å‹

**SE-ResNet** (éœ€è¦è‡ªå®šä¹‰å®ç° SE æ¨¡å—)
```python
def se_block(input_tensor, ratio=16):
    """Squeeze-and-Excitation æ¨¡å—"""
    channels = input_tensor.shape[-1]
    
    # Squeeze
    x = layers.GlobalAveragePooling2D()(input_tensor)
    
    # Excitation
    x = layers.Dense(channels // ratio, activation='relu')(x)
    x = layers.Dense(channels, activation='sigmoid')(x)
    
    # Scale
    x = layers.Reshape((1, 1, channels))(x)
    return layers.Multiply()([input_tensor, x])
```

**ResNeXt-50** (ä½¿ç”¨åˆ†ç»„å·ç§¯)
```python
# å¯ä»¥ä½¿ç”¨ keras_cv æˆ–è‡ªå®šä¹‰å®ç°
# pip install keras-cv
from keras_cv.models import ResNeXt50
```

### 4.4 æˆå‘˜Cæ¨¡å‹

**DenseNet-121**
```python
base_model = keras.applications.DenseNet121(
    weights='imagenet', include_top=False, input_shape=(224, 224, 3)
)
```

**InceptionV3** (æ³¨æ„ï¼šè¾“å…¥å°ºå¯¸ä¸åŒï¼)
```python
# InceptionV3 éœ€è¦ 299x299 è¾“å…¥
base_model = keras.applications.InceptionV3(
    weights='imagenet', include_top=False, input_shape=(299, 299, 3)
)
# éœ€è¦åœ¨ DataLoader ä¸­ç‰¹æ®Šå¤„ç†
```


---

## äº”ã€é›†æˆå­¦ä¹ ï¼ˆç»„é•¿è´Ÿè´£ï¼‰

### 5.1 åˆå¹¶æ‰€æœ‰åˆ†æ”¯

```bash
git checkout main
git pull origin main

# åˆå¹¶å„æˆå‘˜åˆ†æ”¯
git merge model-vgg-mobilenet
git merge model-seresnet-resnext
git merge model-densenet-inception

git push origin main
```

### 5.2 è¿è¡Œé›†æˆå­¦ä¹ 

```python
from src.ensemble.ensemble_model import EnsembleModel
from src.data.data_loader import DRDataLoader
from sklearn.metrics import accuracy_score
import numpy as np

# 1. åŠ è½½æ‰€æœ‰æ¨¡å‹
ensemble = EnsembleModel()
ensemble.load_models('trained_models')

# 2. åŠ è½½æµ‹è¯•æ•°æ®
loader = DRDataLoader(batch_size=32)
test_data = loader.load_test_data()

# è·å–çœŸå®æ ‡ç­¾
y_true = np.concatenate([np.argmax(y, axis=1) for _, y in test_data])

# 3. æµ‹è¯•ä¸åŒæŠ•ç¥¨ç­–ç•¥
for strategy in ['hard_voting', 'soft_voting', 'weighted_voting']:
    y_pred = ensemble.predict(test_data, strategy=strategy)
    acc = accuracy_score(y_true, y_pred)
    print(f"{strategy}: {acc:.4f}")

# 4. ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
ensemble.generate_comparison_report(
    test_data, y_true, 
    'output/evaluation/ensemble_comparison.json'
)
```

### 5.3 è®¾ç½®åŠ æƒæŠ•ç¥¨æƒé‡

æ ¹æ®å„æ¨¡å‹çš„éªŒè¯é›†æ€§èƒ½è®¾ç½®æƒé‡ï¼š

```python
# å‡è®¾å„æ¨¡å‹éªŒè¯é›†å‡†ç¡®ç‡
model_accuracies = {
    'resnet50': 0.85,
    'efficientnet_b0': 0.87,
    'vgg16': 0.82,
    'mobilenetv2': 0.80,
    'se_resnet': 0.86,
    'resnext50': 0.84,
    'densenet121': 0.83,
    'inceptionv3': 0.81
}

# è®¾ç½®æƒé‡ï¼ˆå‡†ç¡®ç‡è¶Šé«˜æƒé‡è¶Šå¤§ï¼‰
ensemble.set_weights(model_accuracies)
```

---

## å…­ã€å¸¸è§é—®é¢˜

### Q1: GPU å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
```python
# å‡å° batch_size
loader = DRDataLoader(batch_size=16)  # æˆ–æ›´å°

# æˆ–è€…ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
from tensorflow.keras import mixed_precision
mixed_precision.set_global_policy('mixed_float16')
```

### Q2: è®­ç»ƒå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ
1. ä½¿ç”¨ GPU è®­ç»ƒ
2. å‡å°‘ epochsï¼Œå¢åŠ  early stopping patience
3. ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆå¦‚ MobileNetV2ï¼‰å…ˆæµ‹è¯•æµç¨‹

### Q3: æ¨¡å‹è¿‡æ‹Ÿåˆæ€ä¹ˆåŠï¼Ÿ
1. å¢åŠ  Dropout æ¯”ä¾‹
2. å¢åŠ æ•°æ®å¢å¼º
3. ä½¿ç”¨æ›´å¼ºçš„æ­£åˆ™åŒ–
4. å‡å°‘æ¨¡å‹å¤æ‚åº¦

### Q4: InceptionV3 è¾“å…¥å°ºå¯¸ä¸åŒæ€ä¹ˆå¤„ç†ï¼Ÿ
```python
# åœ¨ InceptionV3 æ¨¡å‹ä¸­é‡å†™æ•°æ®åŠ è½½
class InceptionV3Model(BaseModel):
    def __init__(self):
        super().__init__(
            model_name='inceptionv3',
            input_shape=(299, 299, 3)  # ç‰¹æ®Šå°ºå¯¸
        )
```

---

## ä¸ƒã€æäº¤æ£€æŸ¥æ¸…å•

æ¯ä¸ªæˆå‘˜æäº¤ PR å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ¨¡å‹æ–‡ä»¶ `{model_name}_best.keras` å­˜åœ¨
- [ ] è®­ç»ƒå†å² `training_history.json` å­˜åœ¨
- [ ] è¯„ä¼°æŠ¥å‘Š `evaluation_report.json` å­˜åœ¨
- [ ] æ··æ·†çŸ©é˜µ `confusion_matrix.png` å­˜åœ¨
- [ ] ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œ
- [ ] æ¨¡å‹å‡†ç¡®ç‡ > 70%ï¼ˆå»ºè®®ï¼‰

---

## å…«ã€é¢„æœŸç»“æœ

| æ¨¡å‹ | é¢„æœŸå‡†ç¡®ç‡ | å¤‡æ³¨ |
|------|-----------|------|
| ResNet-50 | 80-85% | ç»å…¸æ¨¡å‹ï¼Œç¨³å®š |
| EfficientNet-B0 | 82-87% | æ•ˆç‡é«˜ï¼Œæ€§èƒ½å¥½ |
| VGG-16 | 78-83% | ç»“æ„ç®€å•ï¼Œæ˜“ç†è§£ |
| MobileNetV2 | 75-80% | è½»é‡çº§ï¼Œé€Ÿåº¦å¿« |
| SE-ResNet | 82-86% | æ³¨æ„åŠ›æœºåˆ¶å¢å¼º |
| ResNeXt-50 | 81-85% | åˆ†ç»„å·ç§¯ |
| DenseNet-121 | 80-84% | å¯†é›†è¿æ¥ |
| InceptionV3 | 79-83% | å¤šå°ºåº¦ç‰¹å¾ |
| **é›†æˆæ¨¡å‹** | **85-90%** | **é¢„æœŸæœ€ä½³** |

---

## ä¹ã€è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç»„é•¿æˆ–åœ¨ç¾¤é‡Œè®¨è®ºã€‚

ç¥å¤§å®¶é¡ºåˆ©å®Œæˆé¡¹ç›®ï¼ğŸ‰
