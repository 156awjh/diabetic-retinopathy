# ç³–å°¿ç—…è§†ç½‘è†œç—…å˜å›¾åƒåˆ†ç±» - å›¢é˜Ÿä»»åŠ¡è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æˆ‘ä»¬çš„è¯¾è®¾ä»»åŠ¡æ˜¯å¼€å‘ä¸€ä¸ª**ç³–å°¿ç—…è§†ç½‘è†œç—…å˜ï¼ˆDiabetic Retinopathyï¼‰å›¾åƒåˆ†ç±»ç³»ç»Ÿ**ï¼Œæ ¹æ®çœ¼åº•å›¾ç‰‡å°†ç—…å˜ç¨‹åº¦åˆ†ä¸º 5 ä¸ªçº§åˆ«ï¼š

| ç±»åˆ« | ç—…å˜ç¨‹åº¦ | æ ·æœ¬æ•°é‡ | è¯´æ˜ |
|------|----------|----------|------|
| 0 | æ— ç—…å˜ (No DR) | 25,810 | å¥åº·çœ¼åº• |
| 1 | è½»åº¦ (Mild) | 2,443 | è½»å¾®ç—…å˜ |
| 2 | ä¸­åº¦ (Moderate) | 5,292 | ä¸­ç­‰ç—…å˜ |
| 3 | é‡åº¦ (Severe) | 873 | ä¸¥é‡ç—…å˜ |
| 4 | å¢æ®–æ€§ (Proliferative) | 708 | æœ€ä¸¥é‡ï¼Œéœ€è¦ç«‹å³æ²»ç–— |

**æ•°æ®ç‰¹ç‚¹**ï¼šç±»åˆ«ä¸¥é‡ä¸å‡è¡¡ï¼ç±»åˆ«0å 73.5%ï¼Œè€Œç±»åˆ«4åªå 2%ã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œï¼ˆæ•°æ®é›†åˆ’åˆ† + ç±»åˆ«å¹³è¡¡ï¼‰

### 1. æ•°æ®é›†åˆ’åˆ†

æˆ‘å·²ç»å°†æ•°æ®é›†æŒ‰ **70% / 15% / 15%** çš„æ¯”ä¾‹åˆ’åˆ†ä¸ºï¼š
- **è®­ç»ƒé›†**: 24,588 å¼ å›¾ç‰‡ â†’ ç”¨äºè®­ç»ƒæ¨¡å‹
- **éªŒè¯é›†**: 5,269 å¼ å›¾ç‰‡ â†’ ç”¨äºè°ƒå‚å’Œç›‘æ§è¿‡æ‹Ÿåˆ
- **æµ‹è¯•é›†**: 5,269 å¼ å›¾ç‰‡ â†’ ç”¨äºæœ€ç»ˆè¯„ä¼°æ¨¡å‹æ€§èƒ½

ä½¿ç”¨äº†**åˆ†å±‚é‡‡æ ·**ï¼Œç¡®ä¿æ¯ä¸ªå­é›†ä¸­å„ç±»åˆ«çš„æ¯”ä¾‹ä¸åŸå§‹æ•°æ®ä¸€è‡´ã€‚

**è¾“å‡ºæ–‡ä»¶**ï¼ˆåœ¨ `output/preprocessing/` ç›®å½•ä¸‹ï¼‰ï¼š
- `train.csv` - è®­ç»ƒé›†æ–‡ä»¶åˆ—è¡¨
- `val.csv` - éªŒè¯é›†æ–‡ä»¶åˆ—è¡¨
- `test.csv` - æµ‹è¯•é›†æ–‡ä»¶åˆ—è¡¨

### 2. ç±»åˆ«å¹³è¡¡å¤„ç†

ç”±äºæ•°æ®ä¸å‡è¡¡ï¼Œæˆ‘åšäº†ä¸¤ç§å¤„ç†ï¼š

#### (1) è¿‡é‡‡æ ·
å°†å°‘æ•°ç±»ï¼ˆç±»åˆ«3ã€4ï¼‰çš„æ ·æœ¬å¤åˆ¶å¢åŠ ï¼Œä½¿å…¶æ•°é‡æ¥è¿‘ä¸­ä½æ•°ï¼ˆ1,710ï¼‰ï¼š
- ç±»åˆ«3: 611 â†’ 1,710 (+1,099)
- ç±»åˆ«4: 496 â†’ 1,710 (+1,214)

**è¾“å‡ºæ–‡ä»¶**: `train_oversampled.csv`

#### (2) ç±»åˆ«æƒé‡
è®¡ç®—äº†æ¯ä¸ªç±»åˆ«çš„æƒé‡ï¼Œç”¨äºè®­ç»ƒæ—¶çš„æŸå¤±å‡½æ•°ï¼š
```
ç±»åˆ« 0 (æ— ç—…å˜): 0.2722  â† æƒé‡æœ€å°ï¼Œå› ä¸ºæ ·æœ¬æœ€å¤š
ç±»åˆ« 1 (è½»åº¦):   2.8758
ç±»åˆ« 2 (ä¸­åº¦):   1.3276
ç±»åˆ« 3 (é‡åº¦):   8.0484
ç±»åˆ« 4 (å¢æ®–æ€§): 9.9145  â† æƒé‡æœ€å¤§ï¼Œå› ä¸ºæ ·æœ¬æœ€å°‘
```

**è¾“å‡ºæ–‡ä»¶**: `class_weights.json`

### 3. å¯è§†åŒ–

ç”Ÿæˆäº†ä»¥ä¸‹å›¾è¡¨ï¼š
- `class_distribution.png` - åŸå§‹ç±»åˆ«åˆ†å¸ƒ
- `balance_comparison.png` - å¹³è¡¡å‰åå¯¹æ¯”
- `class_weights.png` - ç±»åˆ«æƒé‡åˆ†å¸ƒ

---

## ğŸ¯ ä½ ä»¬éœ€è¦å®Œæˆçš„ä»»åŠ¡

### é¡¹ç›®æ–‡ä»¶ç»“æ„

```
src/preprocessing/augmentation/
â”œâ”€â”€ base.py          # åŸºç±»ï¼ˆå·²å®Œæˆï¼Œä¸éœ€è¦ä¿®æ”¹ï¼‰
â”œâ”€â”€ geometric.py     # ã€ç»„å‘˜Aã€‘å‡ ä½•å˜æ¢
â”œâ”€â”€ color.py         # ã€ç»„å‘˜Bã€‘é¢œè‰²å˜æ¢
â””â”€â”€ advanced.py      # ã€ç»„å‘˜Cã€‘é«˜çº§å¢å¼º
```

---

## ğŸ‘¤ ç»„å‘˜Aä»»åŠ¡ï¼šå‡ ä½•å˜æ¢ï¼ˆgeometric.pyï¼‰

### ä»»åŠ¡ç›®æ ‡
å®ç°å›¾åƒçš„å‡ ä½•å˜æ¢å¢å¼ºï¼ŒåŒ…æ‹¬ï¼šæ—‹è½¬ã€ç¿»è½¬ã€è£å‰ª

### éœ€è¦å®ç°çš„åŠŸèƒ½

#### 1. æ—‹è½¬ (Rotation)
- å°†å›¾ç‰‡éšæœºæ—‹è½¬ä¸€å®šè§’åº¦ï¼ˆå¦‚ -30Â° åˆ° +30Â°ï¼‰
- æ—‹è½¬åå›¾ç‰‡å¤§å°ä¿æŒä¸å˜

#### 2. ç¿»è½¬ (Flip)
- æ°´å¹³ç¿»è½¬ï¼šå·¦å³é•œåƒ
- å‚ç›´ç¿»è½¬ï¼šä¸Šä¸‹é•œåƒ

#### 3. éšæœºè£å‰ª (Random Crop)
- éšæœºè£å‰ªå›¾ç‰‡çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ 80%-100%ï¼‰
- è£å‰ªåéœ€è¦ resize å›åŸå§‹å¤§å°

### å…·ä½“å®ç°æ­¥éª¤

**ç¬¬ä¸€æ­¥ï¼šå®‰è£… OpenCV**
```bash
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**ç¬¬äºŒæ­¥ï¼šæ‰“å¼€æ–‡ä»¶ `src/preprocessing/augmentation/geometric.py`**

**ç¬¬ä¸‰æ­¥ï¼šå®ç° `__call__` æ–¹æ³•**

```python
def __call__(self, image: np.ndarray) -> np.ndarray:
    """
    åº”ç”¨å‡ ä½•å˜æ¢
    """
    import cv2
    
    # åˆ¤æ–­æ˜¯å¦åº”ç”¨å¢å¼ºï¼ˆæ ¹æ®æ¦‚ç‡ï¼‰
    if np.random.random() >= self.probability:
        return image  # ä¸å¢å¼ºï¼Œç›´æ¥è¿”å›åŸå›¾
    
    # 1. éšæœºæ—‹è½¬
    if self.rotation_range > 0:
        angle = np.random.uniform(-self.rotation_range, self.rotation_range)
        image = self._rotate(image, angle)
    
    # 2. æ°´å¹³ç¿»è½¬ï¼ˆ50%æ¦‚ç‡ï¼‰
    if self.horizontal_flip and np.random.random() < 0.5:
        image = self._flip(image, horizontal=True)
    
    # 3. å‚ç›´ç¿»è½¬ï¼ˆ50%æ¦‚ç‡ï¼‰
    if self.vertical_flip and np.random.random() < 0.5:
        image = self._flip(image, horizontal=False)
    
    # 4. éšæœºè£å‰ª
    if self.crop_ratio[0] < 1.0:
        image = self._random_crop(image)
    
    return image
```

**ç¬¬å››æ­¥ï¼šå®ç° `_rotate` æ–¹æ³•**

```python
def _rotate(self, image: np.ndarray, angle: float) -> np.ndarray:
    """æ—‹è½¬å›¾åƒ"""
    import cv2
    
    h, w = image.shape[:2]
    center = (w // 2, h // 2)
    
    # è·å–æ—‹è½¬çŸ©é˜µ
    M = cv2.getRotationMatrix2D(center, angle, 1.0)
    
    # åº”ç”¨æ—‹è½¬
    rotated = cv2.warpAffine(image, M, (w, h), borderMode=cv2.BORDER_REFLECT)
    
    return rotated
```

**ç¬¬äº”æ­¥ï¼šå®ç° `_flip` æ–¹æ³•**

```python
def _flip(self, image: np.ndarray, horizontal: bool = True) -> np.ndarray:
    """ç¿»è½¬å›¾åƒ"""
    import cv2
    
    if horizontal:
        return cv2.flip(image, 1)  # 1 = æ°´å¹³ç¿»è½¬
    else:
        return cv2.flip(image, 0)  # 0 = å‚ç›´ç¿»è½¬
```

**ç¬¬å…­æ­¥ï¼šå®ç° `_random_crop` æ–¹æ³•**

```python
def _random_crop(self, image: np.ndarray) -> np.ndarray:
    """éšæœºè£å‰ª"""
    import cv2
    
    h, w = image.shape[:2]
    
    # éšæœºé€‰æ‹©è£å‰ªæ¯”ä¾‹
    crop_ratio = np.random.uniform(self.crop_ratio[0], self.crop_ratio[1])
    
    # è®¡ç®—è£å‰ªå°ºå¯¸
    new_h = int(h * crop_ratio)
    new_w = int(w * crop_ratio)
    
    # éšæœºé€‰æ‹©è£å‰ªèµ·ç‚¹
    top = np.random.randint(0, h - new_h + 1)
    left = np.random.randint(0, w - new_w + 1)
    
    # è£å‰ª
    cropped = image[top:top+new_h, left:left+new_w]
    
    # resize å›åŸå§‹å¤§å°
    resized = cv2.resize(cropped, (w, h))
    
    return resized
```

### æµ‹è¯•ä½ çš„ä»£ç 

```python
# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æµ‹è¯•ä»£ç 
if __name__ == "__main__":
    import cv2
    
    # è¯»å–ä¸€å¼ æµ‹è¯•å›¾ç‰‡
    img = cv2.imread("data/data2/0/10_left.jpeg")
    
    # åˆ›å»ºå¢å¼ºå™¨
    aug = GeometricAugmentation(
        rotation_range=30,
        horizontal_flip=True,
        vertical_flip=False,
        crop_ratio=(0.8, 1.0),
        probability=1.0  # æµ‹è¯•æ—¶è®¾ä¸º1ï¼Œç¡®ä¿ä¸€å®šåº”ç”¨å¢å¼º
    )
    
    # åº”ç”¨å¢å¼º
    augmented = aug(img)
    
    # æ˜¾ç¤ºç»“æœ
    cv2.imshow("Original", img)
    cv2.imshow("Augmented", augmented)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    
    print("å‡ ä½•å˜æ¢æµ‹è¯•å®Œæˆï¼")
```

---

## ğŸ‘¤ ç»„å‘˜Bä»»åŠ¡ï¼šé¢œè‰²å˜æ¢ï¼ˆcolor.pyï¼‰

### ä»»åŠ¡ç›®æ ‡
å®ç°å›¾åƒçš„é¢œè‰²å˜æ¢å¢å¼ºï¼ŒåŒ…æ‹¬ï¼šäº®åº¦ã€å¯¹æ¯”åº¦ã€è‰²è°ƒã€é¥±å’Œåº¦è°ƒæ•´

### éœ€è¦å®ç°çš„åŠŸèƒ½

#### 1. äº®åº¦è°ƒæ•´ (Brightness)
- è®©å›¾ç‰‡å˜äº®æˆ–å˜æš—
- èŒƒå›´ï¼š0.8-1.2ï¼ˆ0.8å˜æš—ï¼Œ1.2å˜äº®ï¼‰

#### 2. å¯¹æ¯”åº¦è°ƒæ•´ (Contrast)
- å¢åŠ æˆ–å‡å°‘å›¾ç‰‡çš„å¯¹æ¯”åº¦
- èŒƒå›´ï¼š0.8-1.2

#### 3. è‰²è°ƒè°ƒæ•´ (Hue)
- æ”¹å˜å›¾ç‰‡çš„æ•´ä½“è‰²è°ƒ
- éœ€è¦è½¬æ¢åˆ° HSV è‰²å½©ç©ºé—´

#### 4. é¥±å’Œåº¦è°ƒæ•´ (Saturation)
- è®©é¢œè‰²æ›´é²œè‰³æˆ–æ›´ç°æš—
- éœ€è¦è½¬æ¢åˆ° HSV è‰²å½©ç©ºé—´

### å…·ä½“å®ç°æ­¥éª¤

**ç¬¬ä¸€æ­¥ï¼šå®‰è£… OpenCV**
```bash
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**ç¬¬äºŒæ­¥ï¼šæ‰“å¼€æ–‡ä»¶ `src/preprocessing/augmentation/color.py`**

**ç¬¬ä¸‰æ­¥ï¼šå®ç° `__call__` æ–¹æ³•**

```python
def __call__(self, image: np.ndarray) -> np.ndarray:
    """
    åº”ç”¨é¢œè‰²å˜æ¢
    """
    # åˆ¤æ–­æ˜¯å¦åº”ç”¨å¢å¼º
    if np.random.random() >= self.probability:
        return image
    
    # 1. è°ƒæ•´äº®åº¦
    brightness_factor = np.random.uniform(*self.brightness_range)
    image = self._adjust_brightness(image, brightness_factor)
    
    # 2. è°ƒæ•´å¯¹æ¯”åº¦
    contrast_factor = np.random.uniform(*self.contrast_range)
    image = self._adjust_contrast(image, contrast_factor)
    
    # 3. è°ƒæ•´è‰²è°ƒ
    hue_factor = np.random.uniform(*self.hue_range)
    image = self._adjust_hue(image, hue_factor)
    
    # 4. è°ƒæ•´é¥±å’Œåº¦
    saturation_factor = np.random.uniform(*self.saturation_range)
    image = self._adjust_saturation(image, saturation_factor)
    
    return image
```

**ç¬¬å››æ­¥ï¼šå®ç° `_adjust_brightness` æ–¹æ³•**

```python
def _adjust_brightness(self, image: np.ndarray, factor: float) -> np.ndarray:
    """è°ƒæ•´äº®åº¦"""
    # å°†å›¾ç‰‡è½¬ä¸ºæµ®ç‚¹æ•°
    img_float = image.astype(np.float32)
    
    # ä¹˜ä»¥äº®åº¦å› å­
    img_float = img_float * factor
    
    # è£å‰ªåˆ° [0, 255] èŒƒå›´
    img_float = np.clip(img_float, 0, 255)
    
    return img_float.astype(np.uint8)
```

**ç¬¬äº”æ­¥ï¼šå®ç° `_adjust_contrast` æ–¹æ³•**

```python
def _adjust_contrast(self, image: np.ndarray, factor: float) -> np.ndarray:
    """è°ƒæ•´å¯¹æ¯”åº¦"""
    img_float = image.astype(np.float32)
    
    # è®¡ç®—å›¾ç‰‡å‡å€¼
    mean = np.mean(img_float)
    
    # å¯¹æ¯”åº¦è°ƒæ•´å…¬å¼: (pixel - mean) * factor + mean
    img_float = (img_float - mean) * factor + mean
    
    # è£å‰ªåˆ° [0, 255]
    img_float = np.clip(img_float, 0, 255)
    
    return img_float.astype(np.uint8)
```

**ç¬¬å…­æ­¥ï¼šå®ç° `_adjust_hue` æ–¹æ³•**

```python
def _adjust_hue(self, image: np.ndarray, factor: float) -> np.ndarray:
    """è°ƒæ•´è‰²è°ƒ"""
    import cv2
    
    # RGB è½¬ HSV
    hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV).astype(np.float32)
    
    # H é€šé“èŒƒå›´æ˜¯ [0, 180]ï¼Œè°ƒæ•´è‰²è°ƒ
    hsv[:, :, 0] = hsv[:, :, 0] + factor * 180
    hsv[:, :, 0] = np.clip(hsv[:, :, 0], 0, 180)
    
    # HSV è½¬å› RGB
    hsv = hsv.astype(np.uint8)
    rgb = cv2.cvtColor(hsv, cv2.COLOR_HSV2BGR)
    
    return rgb
```

**ç¬¬ä¸ƒæ­¥ï¼šå®ç° `_adjust_saturation` æ–¹æ³•**

```python
def _adjust_saturation(self, image: np.ndarray, factor: float) -> np.ndarray:
    """è°ƒæ•´é¥±å’Œåº¦"""
    import cv2
    
    # RGB è½¬ HSV
    hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV).astype(np.float32)
    
    # S é€šé“ä¹˜ä»¥å› å­
    hsv[:, :, 1] = hsv[:, :, 1] * factor
    hsv[:, :, 1] = np.clip(hsv[:, :, 1], 0, 255)
    
    # HSV è½¬å› RGB
    hsv = hsv.astype(np.uint8)
    rgb = cv2.cvtColor(hsv, cv2.COLOR_HSV2BGR)
    
    return rgb
```

### æµ‹è¯•ä½ çš„ä»£ç 

```python
if __name__ == "__main__":
    import cv2
    
    # è¯»å–æµ‹è¯•å›¾ç‰‡
    img = cv2.imread("data/data2/0/10_left.jpeg")
    
    # åˆ›å»ºå¢å¼ºå™¨
    aug = ColorAugmentation(
        brightness_range=(0.7, 1.3),
        contrast_range=(0.8, 1.2),
        hue_range=(-0.1, 0.1),
        saturation_range=(0.8, 1.2),
        probability=1.0
    )
    
    # åº”ç”¨å¢å¼º
    augmented = aug(img)
    
    # æ˜¾ç¤ºç»“æœ
    cv2.imshow("Original", img)
    cv2.imshow("Augmented", augmented)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    
    print("é¢œè‰²å˜æ¢æµ‹è¯•å®Œæˆï¼")
```

---

## ğŸ‘¤ ç»„å‘˜Cä»»åŠ¡ï¼šé«˜çº§å¢å¼ºï¼ˆadvanced.pyï¼‰

### ä»»åŠ¡ç›®æ ‡
å®ç° **Mixup** æˆ– **CutMix** ä¸­çš„ä¸€ç§ï¼ˆäºŒé€‰ä¸€ï¼‰

### æ–¹æ¡ˆä¸€ï¼šMixupï¼ˆæ¨èï¼Œæ›´ç®€å•ï¼‰

#### åŸç†
å°†ä¸¤å¼ å›¾ç‰‡æŒ‰æ¯”ä¾‹æ··åˆï¼š
```
æ··åˆå›¾ç‰‡ = Î» Ã— å›¾ç‰‡1 + (1-Î») Ã— å›¾ç‰‡2
æ··åˆæ ‡ç­¾ = Î» Ã— æ ‡ç­¾1 + (1-Î») Ã— æ ‡ç­¾2
```

å…¶ä¸­ Î» æ˜¯ä» Beta åˆ†å¸ƒä¸­éšæœºé‡‡æ ·çš„å€¼ï¼ˆ0åˆ°1ä¹‹é—´ï¼‰ã€‚

#### å®ç°æ­¥éª¤

**æ‰“å¼€æ–‡ä»¶ `src/preprocessing/augmentation/advanced.py`**

**å®ç° `MixupAugmentation` ç±»çš„ `__call__` æ–¹æ³•**

```python
def __call__(
    self,
    image1: np.ndarray,
    label1: int,
    image2: np.ndarray,
    label2: int
) -> Tuple[np.ndarray, np.ndarray]:
    """
    åº”ç”¨ Mixup å¢å¼º
    """
    num_classes = 5  # æˆ‘ä»¬æœ‰5ä¸ªç±»åˆ«
    
    # åˆ¤æ–­æ˜¯å¦åº”ç”¨å¢å¼º
    if np.random.random() >= self.probability:
        # ä¸å¢å¼ºï¼Œè¿”å›åŸå›¾å’Œ one-hot æ ‡ç­¾
        one_hot = np.zeros(num_classes)
        one_hot[label1] = 1.0
        return image1, one_hot
    
    # ä» Beta åˆ†å¸ƒé‡‡æ ·æ··åˆæ¯”ä¾‹ Î»
    lam = np.random.beta(self.alpha, self.alpha)
    
    # æ··åˆå›¾åƒ
    mixed_image = lam * image1.astype(np.float32) + (1 - lam) * image2.astype(np.float32)
    mixed_image = mixed_image.astype(np.uint8)
    
    # æ··åˆæ ‡ç­¾ï¼ˆè½¯æ ‡ç­¾ï¼‰
    mixed_label = np.zeros(num_classes)
    mixed_label[label1] = lam
    mixed_label[label2] += (1 - lam)  # ç”¨ += å› ä¸º label1 å¯èƒ½ç­‰äº label2
    
    return mixed_image, mixed_label
```

### æ–¹æ¡ˆäºŒï¼šCutMixï¼ˆç¨å¤æ‚ï¼‰

#### åŸç†
ä»å›¾ç‰‡2ä¸­å‰ªåˆ‡ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œç²˜è´´åˆ°å›¾ç‰‡1ä¸Šï¼š
```
æ··åˆå›¾ç‰‡ = å›¾ç‰‡1ï¼Œä½†æŸä¸ªçŸ©å½¢åŒºåŸŸè¢«å›¾ç‰‡2æ›¿æ¢
æ··åˆæ ‡ç­¾ = æŒ‰é¢ç§¯æ¯”ä¾‹æ··åˆ
```

#### å®ç°æ­¥éª¤

**å®ç° `CutMixAugmentation` ç±»**

```python
def __call__(
    self,
    image1: np.ndarray,
    label1: int,
    image2: np.ndarray,
    label2: int
) -> Tuple[np.ndarray, np.ndarray]:
    """
    åº”ç”¨ CutMix å¢å¼º
    """
    num_classes = 5
    
    if np.random.random() >= self.probability:
        one_hot = np.zeros(num_classes)
        one_hot[label1] = 1.0
        return image1, one_hot
    
    # é‡‡æ · Î»
    lam = np.random.beta(self.alpha, self.alpha)
    
    # è·å–å›¾åƒå°ºå¯¸
    H, W = image1.shape[:2]
    
    # è®¡ç®—å‰ªåˆ‡åŒºåŸŸå¤§å°
    cut_ratio = np.sqrt(1 - lam)
    cut_w = int(W * cut_ratio)
    cut_h = int(H * cut_ratio)
    
    # éšæœºé€‰æ‹©å‰ªåˆ‡ä¸­å¿ƒ
    cx = np.random.randint(W)
    cy = np.random.randint(H)
    
    # è®¡ç®—è¾¹ç•Œï¼ˆç¡®ä¿ä¸è¶…å‡ºå›¾åƒèŒƒå›´ï¼‰
    x1 = np.clip(cx - cut_w // 2, 0, W)
    x2 = np.clip(cx + cut_w // 2, 0, W)
    y1 = np.clip(cy - cut_h // 2, 0, H)
    y2 = np.clip(cy + cut_h // 2, 0, H)
    
    # å‰ªåˆ‡ç²˜è´´
    mixed_image = image1.copy()
    mixed_image[y1:y2, x1:x2] = image2[y1:y2, x1:x2]
    
    # è®¡ç®—å®é™…æ··åˆæ¯”ä¾‹ï¼ˆæŒ‰é¢ç§¯ï¼‰
    lam = 1 - ((x2 - x1) * (y2 - y1) / (W * H))
    
    # æ··åˆæ ‡ç­¾
    mixed_label = np.zeros(num_classes)
    mixed_label[label1] = lam
    mixed_label[label2] += (1 - lam)
    
    return mixed_image, mixed_label
```

### æµ‹è¯•ä½ çš„ä»£ç 

```python
if __name__ == "__main__":
    import cv2
    
    # è¯»å–ä¸¤å¼ æµ‹è¯•å›¾ç‰‡
    img1 = cv2.imread("data/data2/0/10_left.jpeg")
    img2 = cv2.imread("data/data2/1/100_left.jpeg")
    
    # ç¡®ä¿ä¸¤å¼ å›¾ç‰‡å¤§å°ç›¸åŒ
    img2 = cv2.resize(img2, (img1.shape[1], img1.shape[0]))
    
    # æµ‹è¯• Mixup
    mixup = MixupAugmentation(alpha=0.2, probability=1.0)
    mixed_img, mixed_label = mixup(img1, 0, img2, 1)
    
    print(f"æ··åˆæ ‡ç­¾: {mixed_label}")
    
    cv2.imshow("Image 1", img1)
    cv2.imshow("Image 2", img2)
    cv2.imshow("Mixed", mixed_img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    
    print("é«˜çº§å¢å¼ºæµ‹è¯•å®Œæˆï¼")
```

---

## ğŸ“ æäº¤è¦æ±‚

1. **ä»£ç æ–‡ä»¶**ï¼šä¿®æ”¹åçš„ `geometric.py` / `color.py` / `advanced.py`
2. **æµ‹è¯•æˆªå›¾**ï¼šè¿è¡Œæµ‹è¯•ä»£ç çš„ç»“æœæˆªå›¾
3. **ç®€è¦è¯´æ˜**ï¼šç”¨å‡ å¥è¯è¯´æ˜ä½ å®ç°äº†ä»€ä¹ˆåŠŸèƒ½

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è¿è¡Œä»£ç ï¼Ÿ
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate

# è¿è¡Œä½ çš„æ–‡ä»¶
python src/preprocessing/augmentation/geometric.py
```

### Q2: å›¾ç‰‡è¯»å–å¤±è´¥ï¼Ÿ
ç¡®ä¿å›¾ç‰‡è·¯å¾„æ­£ç¡®ï¼Œå¯ä»¥ç”¨ç»å¯¹è·¯å¾„ï¼š
```python
img = cv2.imread(r"D:\ml\data\data2\0\10_left.jpeg")
```

### Q3: ä»€ä¹ˆæ˜¯ np.ndarrayï¼Ÿ
å°±æ˜¯ NumPy æ•°ç»„ï¼Œå›¾ç‰‡åœ¨ Python ä¸­å°±æ˜¯ç”¨è¿™ç§æ ¼å¼å­˜å‚¨çš„ã€‚
- å½¢çŠ¶ `(H, W, C)` è¡¨ç¤ºï¼šé«˜åº¦ã€å®½åº¦ã€é€šé“æ•°ï¼ˆRGB=3ï¼‰
- å€¼èŒƒå›´ `[0, 255]`

### Q4: ä»€ä¹ˆæ˜¯ one-hot æ ‡ç­¾ï¼Ÿ
æ¯”å¦‚ç±»åˆ« 2 çš„ one-hot æ ‡ç­¾æ˜¯ `[0, 0, 1, 0, 0]`ï¼Œåªæœ‰å¯¹åº”ä½ç½®æ˜¯ 1ã€‚

---

## ğŸ“ è”ç³»æ–¹å¼

æœ‰é—®é¢˜éšæ—¶åœ¨ç¾¤é‡Œé—®ï¼
